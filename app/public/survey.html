<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <!-- bootstrap -->

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

  <title>Survey</title>
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
    <div class="collapse navbar-collapse" id="navbarNavDropdown">
      <ul class="navbar-nav">
        <li class="nav-item active">
          <a class="nav-link" href="/home.html">Home <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/api/friends">API Friends List</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Survey</a>
        </li>
      </ul>
    </div>
  </nav>

  <div class="input-group">
    <div class="input-group-prepend">
      <span class="input-group-text">First and last name</span>
    </div>
    <input type="text" class="form-control" id="firstnamefield">
    <input type="text" class="form-control" id="lastnamefield">

  </div>

  <div class="input-group">
    <div class="input-group-prepend">
      <span class="input-group-text">Picture Link</span>
    </div>
    <input type="text" class="form-control" id="picturelink">

  </div>

  <div class="Question">
    <h3> I am very outgoing! </h3>
    <div class="input-group mb-3 col-sm-3">
      <div class="input-group-prepend">
        <label class="input-group-text" for="inputGroupSelect01">Options</label>
      </div>
      <select class="custom-select" id="q1">
    <option selected value = "0">Choose...</option>
    <option value="1">Disagree!</option>
    <option value="2">Disagree Somewhat</option>
    <option value="3">Impartial</option>
    <option value="4">Agree Somewhat</option>
    <option value="5">Agree Strongly!</option>
  </select>
    </div>
  </div>

  <div class="Question">
    <h3> I prefer: </h3>
    <div class="input-group mb-3 col-sm-3">
      <div class="input-group-prepend">
        <label class="input-group-text" for="inputGroupSelect01">Options</label>
      </div>
      <select class="custom-select" id="q2">
    <option selected value = "0">Choose...</option>
    <option value="1">Swelteringly Hot Weather</option>
    <option value="2">Hot Weather</option>
    <option value="3">Stormy Weather</option>
    <option value="4">Brisk Weather </option>
    <option value="5">Frigid Weather </option>
  </select>
    </div>
  </div>

  <div class="Question">
    <h3> I prefer sitting at home calculating formulated and intricate plots to kill my enemies to engaging in open war </h3>
    <div class="input-group mb-3 col-sm-3">
      <div class="input-group-prepend">
        <label class="input-group-text" for="inputGroupSelect01">Options</label>
      </div>
      <select class="custom-select" id="q3">
    <option selected value = "0">Choose...</option>
    <option value="1">Agree!</option>
    <option value="2">Impartial, as long as my enemies die</option>
    <option value="3">Disagree!</option>

  </select>
    </div>
  </div>

  <div class="Question">
    <h3> I love to  </h3>
    <div class="input-group mb-3 col-sm-3">
      <div class="input-group-prepend">
        <label class="input-group-text" for="inputGroupSelect01">Options</label>
      </div>
      <select class="custom-select" id="q4">
    <option selected value = "0">Choose...</option>
    <option value="1">Attend Weddings!</option>
    <option value="2">Play Music</option>
    <option value="3">Host Weddings!</option>
    <option value="4">Drink </option>
    <option value="5">Fight </option>
  </select>
    </div>
  </div>

  <div class="Question">
    <h3> My favorite food is:  </h3>
    <div class="input-group mb-3 col-sm-3">
      <div class="input-group-prepend">
        <label class="input-group-text" for="inputGroupSelect01">Options</label>
      </div>
      <select class="custom-select" id="q5">
    <option selected value = "0">Choose...</option>
    <option value="1">Pies</option>
    <option value="2">Aurochs</option>
    <option value="3">Lemon Cakes</option>
    <option value="4">Wine</option>
    <option value="5">Chickens</option>
  </select>
    </div>
  </div>


  <div class="Question">
    <h3> My drink of choice is: </h3>
    <div class="input-group mb-3 col-sm-3">
      <div class="input-group-prepend">
        <label class="input-group-text" for="inputGroupSelect01">Options</label>
      </div>
      <select class="custom-select" id="q6">
    <option selected value = "0">Choose...</option>
    <option value="1">Wine</option>
    <option value="2">Dark Beer</option>
    <option value="3">I do not partake</option>
  </select>
    </div>
  </div>

  <div class="Question">
    <h3> I spend most of my time </h3>
    <div class="input-group mb-3 col-sm-3">
      <div class="input-group-prepend">
        <label class="input-group-text" for="inputGroupSelect01">Options</label>
      </div>
      <select class="custom-select" id="q7">
    <option selected value = "0">Choose...</option>
    <option value="1">Reading</option>
    <option value="2">Fighting</option>
    <option value="3">Watching my enemies destroy each other</option>
    <option value="4">Ruling</option>
    <option value="5">Arguinig</option>
  </select>
    </div>
  </div>


  <div class="Question">
    <h3> I fight best  </h3>
    <div class="input-group mb-3 col-sm-3">
      <div class="input-group-prepend">
        <label class="input-group-text" for="inputGroupSelect01">Options</label>
      </div>
      <select class="custom-select" id="q8">
    <option selected value = "0">Choose...</option>
    <option value="1">With my words</option>
    <option value="2">On horseback</option>
    <option value="3">In a suit of armor</option>
    <option value="4">Lone wolfing it</option>
    <option value="5">Riding my dragon and making others fight for me </option>
  </select>
    </div>
  </div>

  <div class="Question">
    <h3> My favorite animal is a </h3>
    <div class="input-group mb-3 col-sm-3">
      <div class="input-group-prepend">
        <label class="input-group-text" for="inputGroupSelect01">Options</label>
      </div>
      <select class="custom-select" id="q9">
    <option selected value = "0">Choose...</option>
    <option value="1">Wolf</option>
    <option value="2">Lion</option>
    <option value="3">Dragon</option>
    <option value="4">Dog</option>
    <option value="5">Kraken</option>
  </select>
    </div>
  </div>

  <div class="Question">
    <h3> My priority is </h3>
    <div class="input-group mb-3 col-sm-3">
      <div class="input-group-prepend">
        <label class="input-group-text" for="inputGroupSelect01">Options</label>
      </div>
      <select class="custom-select" id="q10">
    <option selected value = "0">Choose...</option>
    <option value="1">to be seen as honorable no matter the outcome</option>
    <option value="2">to win no matter the cost</option>
    <option value="3">to live to a ripe old age and die fat, happy, and soaked in wine</option>
    <option value="4">to rule over all who are subservient to me, so everyone </option>
    <option value="5">to do the right thing </option>

  </select>
    </div>
  </div>


  <button type="button" class="btn btn-primary" id="submit" data-toggle="modal" data-target="#displaymodal">Find Friend!</button>
  <div class="modal fade" id="displaymodal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Your New Best Friend!</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" id="match">

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal" id="modalclose">Close</button>

        </div>
      </div>
    </div>
  </div>
  <!-- <div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" id = "displaymodal">
    <div class="modal-dialog modal-lg">
      <div class="modal-content" id = "match">

      </div>
    </div>
  </div> -->


  <!-- Java files -->

  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery.js"></script>
</body>

</html>

<script type="text/javascript">
  //get function to pull api info
  var answers = []
  var scores = [];
  var differences = [];
  var friends = [];
  var min;
  var newfriend;
  var index;

  function getprevious() {
    scores = [];
    friends = [];
    $.get("/api/friends", function(data) {


      // console.log(data);
      for (var k = 0; k < data.length; k++) {
        friends.push(data[k]);
        // var parsed;
        for (var n = 0; n < data[k].questions.length; n++) {
          data[k].questions[n] = parseInt(data[k].questions[n]);

        }
        scores.push(data[k].questions);
      }

    });
  };



  getprevious();
  $("#submit").on("click", function(event) {
    event.preventDefault();
    createnewfriend();
    finddifferences();


    console.log("New Friend Object:");
    console.log(newfriend);
    console.log("Scores array");
    console.log(scores);
    console.log("friendsarray");
    console.log(friends);





    index = findsmallestdifference();
    console.log("Index" + index);
    printfriend();

    $.post("/api/friends", newfriend,
      function(data) {
        if (data) {
          alert("Added!");

        } else {
          alert("Something went wrong...");
        }
      });



  })

  $("#modalclose").on("click", function(event) {
    event.preventDefault();
    $("#match").empty();
  })


  function createnewfriend() {
    newfriend = {};
    answers = [];
    //for loop to get values from questions and push them into an answers array for newfriend object

    for (var i = 1; i < 11; i++) {
      var id = "#q" + i;

      answers.push(parseInt($(id).val().trim()));
      $(id).val("0");
    }
    console.log("Answersarray:");
    console.log(answers);

    //create newfriend object
     newfriend = {
      name: $("#firstnamefield").val().trim() + " " + $("#lastnamefield").val().trim(),
      picturelink: $("#picturelink").val().trim(),
      questions: answers
    }

    //blank out fields
    $("#firstnamefield").val("");
    $("#lastnamefield").val("");
    $("#picturelink").val("");

  };

  function finddifferences() {
    differences = [];
    for (var l = 0; l < scores.length; l++) {
      for (var p = 0; p < scores[l].length; p++) {
        var totalDifference = Math.abs(answers[p] - scores[l][p]);
      }

      differences.push(totalDifference);

    }
    console.log("Differences Array");
    console.log(differences);


    min = Math.min.apply(Math, differences);
    console.log("min" + min);
  };

  function findsmallestdifference() {
    for (var u = 0; u < differences.length; u++) {
      if (differences[u] == min) {
        return u;
      }
    }
  }

  function printfriend() {
    var matchname = friends[index].name;
    var matchpicture = friends[index].picturelink;
    $("#match").append("<h3>" + matchname + "</h3>");
    $("#match").append("<img class = matchpic src = " + matchpicture + " alt = pic of your match>")
  };
</script>
